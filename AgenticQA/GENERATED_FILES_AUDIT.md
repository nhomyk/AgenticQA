# Generated Files Audit - CI Pipeline üìã

## Goal
**Ensure ALL generated files in a test run are ingested to Weaviate for agent learning.**

## Current State Analysis

### ‚úÖ Files Currently Ingested

| File | Generated By | Ingested By | Status |
|------|-------------|-------------|--------|
| `jest-output.log` | Jest tests | `ingest_ci_artifacts.py --test-results` | ‚úÖ INGESTED |
| `vitest-output.log` | Vitest tests | `ingest_ci_artifacts.py --test-results` | ‚úÖ INGESTED |
| `playwright-output.log` | Playwright tests | `ingest_ci_artifacts.py --test-results` | ‚úÖ INGESTED |
| `cypress-output.log` | Cypress tests | `ingest_ci_artifacts.py --test-results` | ‚úÖ INGESTED |
| `pa11y-report.txt` | Pa11y scan | `ingest_ci_artifacts.py --pa11y-report` | ‚úÖ INGESTED |
| `pa11y-revalidate.txt` | Pa11y re-scan | `ingest_ci_artifacts.py --pa11y-report` | ‚úÖ INGESTED |
| `audit-report.json` | npm audit | `ingest_ci_artifacts.py --security-audit` | ‚úÖ INGESTED |

### ‚ö†Ô∏è Files NOT Currently Ingested

| File | Generated By | Purpose | Should Ingest? |
|------|-------------|---------|----------------|
| `pa11y-report.json` | Pa11y scan | JSON summary of scan | ‚úÖ **YES** |
| `pa11y-revalidate.json` | Pa11y re-scan | JSON summary of re-validation | ‚úÖ **YES** |
| `autofix-output.txt` | ComplianceAgent | Auto-fix execution log | ‚úÖ **YES** |
| `pipeline-health.log` | Pipeline validation | Health check results | ‚úÖ **YES** |
| `test-failures/*.txt` | Test failure extraction | Specific error messages | ‚úÖ **YES** |
| `/tmp/server.log` | Dev server | Server startup/errors | ‚ö†Ô∏è **MAYBE** |
| `/tmp/server-revalidate.log` | Dev server (revalidate) | Server startup/errors | ‚ö†Ô∏è **MAYBE** |
| Coverage reports | Jest/Vitest | Code coverage data | ‚úÖ **YES** |

### üìù Generated But Not Persisted (Computed Values)

| Data | Computed By | Purpose | Should Ingest? |
|------|------------|---------|----------------|
| `ERROR_COUNT` | Pa11y step | Number of violations | ‚úÖ Already stored in pattern |
| `ERRORS_BEFORE/AFTER` | Re-validation | Fix effectiveness | ‚úÖ Already stored in pattern |
| Test status outputs | Each test step | Pass/fail status | ‚úÖ Already in test logs |

## Detailed Analysis

### 1. Pa11y JSON Reports (NOT INGESTED)

**Files:**
- `pa11y-report.json`
- `pa11y-revalidate.json`

**Currently Generated:**
```json
{
  "timestamp": "2026-02-04T16:36:35Z",
  "url": "http://localhost:8080",
  "errorCount": 0,
  "status": "completed"
}
```

**Why Ingest:** Structured data with timestamps and error counts - useful for time-series analysis

**Recommendation:** ‚úÖ **ADD INGESTION**

### 2. Auto-Fix Execution Log (NOT INGESTED)

**File:** `autofix-output.txt`

**Contains:**
- ComplianceAgent execution details
- Fixes applied
- Success/failure messages
- Agent decision-making process

**Why Ingest:** Provides context on HOW fixes were applied - useful for debugging and improving agent logic

**Recommendation:** ‚úÖ **ADD INGESTION**

### 3. Pipeline Health Log (NOT INGESTED)

**File:** `pipeline-health.log`

**Contains:**
- Pipeline validation results
- Critical test outcomes
- System health metrics

**Why Ingest:** Early warning system for pipeline issues - helps agents learn what breaks

**Recommendation:** ‚úÖ **ADD INGESTION**

### 4. Test Failure Details (NOT INGESTED)

**Files:**
- `test-failures/jest-errors.txt`
- `test-failures/vitest-errors.txt`
- `test-failures/playwright-errors.txt`
- `test-failures/cypress-errors.txt`

**Contains:**
- Extracted error messages
- Failure context
- Stack traces

**Why Ingest:** Specific failure patterns help agents learn common pitfalls

**Recommendation:** ‚úÖ **ADD INGESTION**

### 5. Code Coverage Reports (NOT INGESTED)

**Files:**
- `coverage/` directory (Jest)
- `coverage/` directory (Vitest)

**Contains:**
- Line coverage percentages
- Uncovered code blocks
- Coverage trends

**Why Ingest:** Helps SDET agent prioritize test generation

**Recommendation:** ‚úÖ **ADD INGESTION**

### 6. Server Logs (CURRENTLY IGNORED)

**Files:**
- `/tmp/server.log`
- `/tmp/server-revalidate.log`

**Contains:**
- Server startup messages
- Runtime errors
- Port binding issues

**Why Ingest:** May contain useful deployment error patterns

**Recommendation:** ‚ö†Ô∏è **OPTIONAL** (usually not critical, but could be useful for DevOps agent)

## Implementation Plan

### Priority 1: High-Value Files (Immediate)

1. **Pa11y JSON Reports**
   ```bash
   python ingest_ci_artifacts.py \
     --pa11y-report pa11y-report.json \
     --run-id ${{ github.run_id }}
   ```

2. **Auto-Fix Execution Log**
   ```bash
   python ingest_ci_artifacts.py \
     --agent-log autofix-output.txt \
     --agent-type compliance \
     --run-id ${{ github.run_id }}
   ```

3. **Test Failure Details**
   ```bash
   python ingest_ci_artifacts.py \
     --test-failures test-failures/ \
     --run-id ${{ github.run_id }}
   ```

### Priority 2: Coverage & Health (Next)

4. **Code Coverage Reports**
   ```bash
   python ingest_ci_artifacts.py \
     --coverage-report coverage/coverage-summary.json \
     --run-id ${{ github.run_id }}
   ```

5. **Pipeline Health Log**
   ```bash
   python ingest_ci_artifacts.py \
     --pipeline-health pipeline-health.log \
     --run-id ${{ github.run_id }}
   ```

### Priority 3: Server Logs (Optional)

6. **Server Logs** (if needed)
   ```bash
   python ingest_ci_artifacts.py \
     --server-log /tmp/server.log \
     --run-id ${{ github.run_id }}
   ```

## Required Code Changes

### 1. Update `ingest_ci_artifacts.py`

Add new ingestion methods:

```python
def ingest_agent_log(self, log_path: str, agent_type: str, run_id: str):
    """Ingest agent execution logs"""
    # Parse autofix-output.txt
    # Extract: fixes applied, decisions made, success/failure
    # Store to Weaviate with doc_type="agent_execution_log"

def ingest_test_failures(self, failures_dir: str, run_id: str):
    """Ingest extracted test failure messages"""
    # Parse test-failures/*.txt
    # Extract: error patterns, stack traces
    # Store to Weaviate with doc_type="test_failure_pattern"

def ingest_coverage_report(self, coverage_path: str, run_id: str):
    """Ingest code coverage data"""
    # Parse coverage-summary.json
    # Extract: line coverage %, uncovered files
    # Store to Weaviate with doc_type="coverage_report"

def ingest_pipeline_health(self, health_log: str, run_id: str):
    """Ingest pipeline health check results"""
    # Parse pipeline-health.log
    # Extract: test results, system health
    # Store to Weaviate with doc_type="pipeline_health"
```

### 2. Update CI Workflow

Add ingestion steps after each report generation:

```yaml
# After Pa11y scan
- name: Ingest Pa11y JSON to Weaviate
  run: |
    python ingest_ci_artifacts.py \
      --pa11y-report pa11y-report.json \
      --run-id ${{ github.run_id }}

# After auto-fix
- name: Ingest Auto-Fix Log to Weaviate
  run: |
    python ingest_ci_artifacts.py \
      --agent-log autofix-output.txt \
      --agent-type compliance \
      --run-id ${{ github.run_id }}

# After test failures
- name: Ingest Test Failures to Weaviate
  if: failure()
  run: |
    python ingest_ci_artifacts.py \
      --test-failures test-failures/ \
      --run-id ${{ github.run_id }}

# After coverage generation
- name: Ingest Coverage Report to Weaviate
  run: |
    python ingest_ci_artifacts.py \
      --coverage-report coverage/coverage-summary.json \
      --run-id ${{ github.run_id }}
```

## Benefits of Complete Ingestion

### 1. Comprehensive Learning
- Agents learn from ALL data, not just subset
- Better pattern recognition
- More accurate predictions

### 2. Root Cause Analysis
- Auto-fix logs show decision-making process
- Test failures reveal common error patterns
- Coverage gaps identify testing priorities

### 3. Cross-Agent Intelligence
- ComplianceAgent learns from auto-fix logs
- SDET learns from coverage gaps
- QA learns from test failure patterns
- DevOps learns from pipeline health

### 4. Time-Series Analysis
- Track improvement over time
- Identify regression patterns
- Measure agent effectiveness

## Current Ingestion Coverage

```
Phase 1 Tests (QA/SDET):
‚úÖ Jest output logs
‚úÖ Vitest output logs
‚úÖ Playwright output logs
‚úÖ Cypress output logs
‚ùå Test failure details
‚ùå Coverage reports

Compliance Checks:
‚úÖ Pa11y text report
‚ùå Pa11y JSON report
‚ùå Pa11y revalidate JSON
‚ùå Auto-fix execution log

Security:
‚úÖ npm audit JSON

Pipeline:
‚ùå Pipeline health log
‚ùå Server logs
```

**Current Coverage:** 50% (5/10 file types)
**Target Coverage:** 90%+ (9/10 file types, excluding optional server logs)

## Next Steps

1. **Audit Implementation** (this document) ‚úÖ DONE
2. **Update `ingest_ci_artifacts.py`** - Add new ingestion methods
3. **Update CI workflow** - Add ingestion steps for missing files
4. **Test locally** - Verify all ingestion methods work
5. **Deploy to CI** - Push changes and monitor
6. **Verify in Weaviate** - Check all doc_types exist

## Success Criteria

‚úÖ All generated reports/logs ingested to Weaviate
‚úÖ No "file not found" errors in ingestion logs
‚úÖ Weaviate contains 10+ doc_types (not just 3-4)
‚úÖ Agents can query all historical data
‚úÖ Time-series analysis possible

---

**Status:** üìä **AUDIT COMPLETE** - Ready for implementation
**Next:** Update `ingest_ci_artifacts.py` with new methods
